@using FluentValidation
@using DiscordSecretSanta.Blazor.Shared.Modals
@inject IStringLocalizer<SharedResources> Translate
@inject IModalService ModalService

<Row>
    <Column ColumnSize="@ColumnSize.Is9">
        <Text TextTransform="TextTransform.Uppercase">@Label</Text>
        <Text style="display: block">@DisplayValue</Text>
    </Column>
    <Column ColumnSize="@ColumnSize.Is3" TextAlignment="TextAlignment.End">
        <SimpleButton 
            Clicked="@ShowModal"
        >@Translate["Edit"]</SimpleButton>
    </Column>
</Row>

@code {

    [Parameter]
    public string Label { get; set; }

    [Parameter]
    public string Value { get; set; } = string.Empty;

    [Parameter]
    public EventCallback<string> OnSubmit { get; set; }

    [Parameter]
    public Action<ValidatorEventArgs> Validator { get; set; } = null!;

    [Parameter]
    public string ModalTitle { get; set; } = string.Empty;
    
    string DisplayValue => !string.IsNullOrWhiteSpace(Value) ? Value : @Translate["Placeholder"];

    public Task ShowModal()
    {
        return ModalService.Show<EditFieldModal>(x =>
            {
                x.Add(z => z.Title, ModalTitle);
                x.Add(z => z.Label, Label);
                x.Add(z => z.StartingValue, Value);
                x.Add(z => z.Validator, Validator);
                x.Add(z => z.OnSubmit, OnSubmit);
            }, 
            new ModalInstanceOptions()
            {
                UseModalStructure = false,
                Centered = true
            }
        );
    }

}